<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>论坛工作人员双语跟读练习</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
            overflow-x: hidden;
            flex-direction: column;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            margin-bottom: 30px;
        }
        
        header {
            background: linear-gradient(90deg, #1a2980, #26d0ce);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            padding: 30px;
        }
        
        .progress-container {
            margin: 0 0 25px;
            background: #f0f0f0;
            border-radius: 10px;
            height: 12px;
            overflow: hidden;
            width: 100%;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #1a2980, #26d0ce);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin: 10px 0 20px;
            font-weight: 500;
            color: #555;
        }
        
        .dialogue-area {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        
        .phrase-card {
            width: 100%;
            margin: 20px 0;
            text-align: center;
            padding: 25px;
            border-radius: 15px;
            background: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .phrase-chinese {
            font-size: 1.8rem;
            font-weight: 500;
            margin-bottom: 15px;
            color: #1a2980;
            line-height: 1.4;
        }
        
        .phrase-pinyin {
            font-size: 1.2rem;
            color: #666;
            font-style: italic;
            margin-bottom: 20px;
        }
        
        .phrase-english {
            font-size: 1.6rem;
            color: #1a2980;
            font-weight: 500;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .audio-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s;
            padding: 15px;
            border-radius: 15px;
            min-width: 140px;
            background: white;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .audio-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .audio-btn i {
            font-size: 2.5rem;
            color: #1a2980;
            background: #e3f2fd;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .audio-btn:hover i {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: white;
            transform: scale(1.1);
        }
        
        .audio-btn span {
            font-weight: 600;
            color: #333;
        }
        
        .recording-section {
            margin: 20px 0;
            width: 100%;
            text-align: center;
        }
        
        .recording-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            font-weight: 500;
            height: 40px;
            font-size: 1.1rem;
        }
        
        .record-dot {
            width: 15px;
            height: 15px;
            background: #e74c3c;
            border-radius: 50%;
            opacity: 0;
        }
        
        .recording .record-dot {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .buttons-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }
        
        .btn {
            padding: 15px 25px;
            font-size: 1.1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #1a2980, #26d0ce);
            color: white;
            box-shadow: 0 4px 10px rgba(26, 41, 128, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(26, 41, 128, 0.4);
        }
        
        .btn-secondary {
            background: white;
            color: #1a2980;
            border: 2px solid #1a2980;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .btn-secondary:hover {
            background: #e3f2fd;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            width: 100%;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .scene-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        .scene-title {
            font-size: 1.3rem;
            color: #1a2980;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #26d0ce;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .scene-description {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .scene-description > div {
            flex: 1;
            min-width: 200px;
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .scene-description h3 {
            color: #1a2980;
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tips {
            background: #fff8e1;
            padding: 20px;
            border-radius: 15px;
            margin-top: 25px;
            font-size: 1rem;
            border-left: 4px solid #ffc107;
        }
        
        .tips h3 {
            color: #1a2980;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }
        
        .tips ul {
            padding-left: 20px;
        }
        
        .tips li {
            margin: 12px 0;
            line-height: 1.6;
        }
        
        .completion-message {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .completion-message h2 {
            font-size: 2.5rem;
            color: #1a2980;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }
        
        .completion-message p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #555;
        }
        
        .stars {
            font-size: 3rem;
            color: #ffc107;
            margin: 20px 0;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .stars i {
            animation: spin 3s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .phrase-chinese {
                font-size: 1.5rem;
            }
            
            .phrase-english {
                font-size: 1.3rem;
            }
            
            .audio-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .scene-description > div {
                min-width: 100%;
            }
        }
        
        /* 语音波形动画 */
        .voice-wave {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 50px;
            margin: 15px 0;
        }
        
        .wave-bar {
            width: 4px;
            height: 20px;
            background: #26d0ce;
            margin: 0 2px;
            border-radius: 2px;
            animation: wave 1.2s ease-in-out infinite;
        }
        
        .wave-bar:nth-child(1) { animation-delay: 0s; }
        .wave-bar:nth-child(2) { animation-delay: 0.1s; }
        .wave-bar:nth-child(3) { animation-delay: 0.2s; }
        .wave-bar:nth-child(4) { animation-delay: 0.3s; }
        .wave-bar:nth-child(5) { animation-delay: 0.4s; }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }
        
        /* 状态指示器 */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin: 5px 0;
        }
        
        .status-recording {
            background: #ffebee;
            color: #c62828;
        }
        
        .status-playing {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .recording-dot {
            background: #c62828;
            animation: blink 1s infinite;
        }
        
        .playing-dot {
            background: #2e7d32;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* 录音可视化 */
        .visualizer-container {
            width: 100%;
            height: 100px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #visualizer {
            width: 100%;
            height: 100px;
            background: rgba(38, 208, 206, 0.1);
            border-radius: 10px;
        }
        
        canvas {
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }
        
        /* 音频播放器 */
        .audio-player {
            width: 100%;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .audio-player audio {
            width: 100%;
        }
        
        .audio-player-controls {
            display: flex;
            gap: 10px;
        }
        
        /* 录音计时器 */
        .recording-timer {
            font-weight: bold;
            font-size: 1.2rem;
            color: #e74c3c;
            margin-top: 10px;
        }
        
        /* 按钮状态指示 */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .btn:disabled i {
            background: #f0f0f0 !important;
            color: #999 !important;
        }
        
        /* 开发公司信息样式 */
        .developer-info {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 900px;
            color: white;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .developer-info p {
            margin: 10px 0;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .developer-info .company {
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        .developer-info .contact {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            font-style: italic;
        }
        
        .developer-info i {
            width: 20px;
            text-align: center;
            color: #ffd700;
        }
        
        @media (max-width: 768px) {
            .developer-info p {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>东盟博览会发展论坛双语跟读练习助手</h1>
            <p class="subtitle">练习常用中英双语表达，提升您的国际会议服务能力</p>
        </header>
        
        <div class="game-container">
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="progress-info">
                <span id="progress-text">学习进度: 0/50 (0%)</span>
                <span id="score-detail">已完成: 0/50</span>
            </div>
            
            <div class="dialogue-area">
                <div class="phrase-card">
                    <div class="phrase-chinese" id="phrase-chinese">您好！请出示您的邀请函和护照。</div>
                    <div class="phrase-pinyin" id="phrase-pinyin">Nín hǎo! Qǐng chūshì nín de yāoqǐnghán hùzhào.</div>
                    <div class="phrase-english" id="phrase-english">Hello! May I have your invitation letter and passport, please?</div>
                    
                    <div class="voice-wave" id="voice-wave">
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                        <div class="wave-bar"></div>
                    </div>
                </div>
                
                <div class="audio-controls">
                    <div class="audio-btn" id="play-chinese-btn">
                        <i class="fas fa-volume-up"></i>
                        <span>播放中文</span>
                    </div>
                    <div class="audio-btn" id="play-english-btn">
                        <i class="fas fa-volume-up"></i>
                        <span>播放英文</span>
                    </div>
                    <div class="audio-btn" id="play-slow-btn">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>慢速播放</span>
                    </div>
                </div>
                
                <div class="status-indicator" id="status-indicator">
                    <div class="status-dot playing-dot"></div>
                    <span>准备播放...</span>
                </div>
                
                <div class="recording-section">
                    <div class="recording-indicator" id="recording-indicator">
                        <div class="record-dot"></div>
                        <div>准备跟读 - 点击下方按钮开始</div>
                    </div>
                    
                    <!-- 录音可视化 -->
                    <div class="visualizer-container">
                        <div id="visualizer">
                            <canvas id="visualizer-canvas"></canvas>
                        </div>
                    </div>
                    
                    <div class="buttons-container">
                        <button class="btn btn-primary" id="record-btn">
                            <i class="fas fa-microphone"></i> 开始跟读
                        </button>
                        <button class="btn btn-secondary" id="playback-btn" disabled>
                            <i class="fas fa-play-circle"></i> 播放我的录音
                        </button>
                        <button class="btn btn-secondary" id="save-btn" disabled>
                            <i class="fas fa-save"></i> 保存录音
                        </button>
                    </div>
                    
                    <div class="recording-timer" id="recording-timer">00:00</div>
                    
                    <!-- 录音播放器 -->
                    <div class="audio-player" id="audio-player" style="display: none;">
                        <audio id="audio-playback" controls></audio>
                        <div class="audio-player-controls">
                            <button class="btn btn-secondary" id="play-audio-btn">
                                <i class="fas fa-play"></i> 播放
                            </button>
                            <button class="btn btn-secondary" id="pause-audio-btn">
                                <i class="fas fa-pause"></i> 暂停
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-secondary" id="prev-btn">
                        <i class="fas fa-arrow-left"></i> 上一句
                    </button>
                    <button class="btn btn-secondary" id="retry-btn">
                        <i class="fas fa-redo"></i> 重试本句
                    </button>
                    <button class="btn btn-primary" id="next-btn">
                        下一句 <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
            
            <div class="scene-info">
                <h2 class="scene-title"><i class="fas fa-map-marker-alt"></i> 当前场景：<span id="current-scene">报到注册</span></h2>
                
                <div class="scene-description">
                    <div>
                        <h3><i class="fas fa-clock"></i> 时间</h3>
                        <p id="current-time">6-7日全天</p>
                    </div>
                    <div>
                        <h3><i class="fas fa-info-circle"></i> 场景说明</h3>
                        <p id="scene-description">参会嘉宾抵达会议现场，需要完成注册手续并获取会议资料</p>
                    </div>
                </div>
            </div>
            
            <div class="tips">
                <h3><i class="fas fa-lightbulb"></i> 跟读练习技巧</h3>
                <ul>
                    <li><strong>先听原声</strong>：仔细听原声的发音、语调和节奏</li>
                    <li><strong>分段跟读</strong>：长句子可以分成几个小段分别练习</li>
                    <li><strong>注意重音</strong>：英语中重音位置会影响词义，要特别注意</li>
                    <li><strong>模仿语调</strong>：英语的语调变化比中文更丰富，注意模仿</li>
                    <li><strong>录音对比</strong>：录制自己的发音与原声对比，找出差异</li>
                    <li><strong>每日练习</strong>：每天练习15分钟比一次练习2小时效果更好</li>
                </ul>
            </div>
            
            <div class="completion-message" id="completion-message">
                <h2><i class="fas fa-trophy"></i> 恭喜完成练习！</h2>
                <p>您已经完成了所有50句双语表达练习</p>
                <div class="stars">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <p>您的国际会议服务能力已得到显著提升！</p>
                <button class="btn btn-primary" id="restart-btn">
                    <i class="fas fa-sync-alt"></i> 重新开始练习
                </button>
            </div>
        </div>
    </div>

    <!-- 开发公司信息 -->
    <div class="developer-info">
        <p><i class="fas fa-building"></i> 开发公司：<span class="company">广西凯格企业管理咨询有限责任公司</span></p>
        <p><i class="fas fa-user"></i> 联系人：谢老师 15577119224</p>
        <p><i class="fab fa-weixin"></i> 微信号：carolegirls </p>
        <p><i class="fas fa-globe"></i> 网址：<a href="http://www.kingoldedu.com/" target="_blank">http://www.kingoldedu.com/</a></p>
        <p class="contact"><i class="fas fa-comments"></i> 有任何问题和建议请及时和我们反馈</p>
    </div>

    <script>
        // 题库数据 - 根据提供的文档内容更新
        const phrases = [
            {
                scene: "报到注册",
                time: "6-7日全天",
                description: "参会嘉宾抵达会议现场，需要完成注册手续并获取会议资料",
                chinese: "您好！请扫描二维码，谢谢",
                pinyin: "Nín hǎo！ qǐng sǎomiáo èrwéimǎ，xiè xie",
                english: "welcome,Please scan the QR code . Thank you. "
            },

   {
                scene: "报到注册",
                time: "6-7日全天",
                description: "参会嘉宾抵达会议现场，需要完成现场签到",
                chinese: "您好！请在这边签到，谢谢",
                pinyin: "Nín hǎo! Qǐng zài zhèbiān qiāndào, xièxie.",
                english: "Hello, please check in here. Thank you. "
            },


            {
                scene: "报到注册",
                time: "6-7日全天",
                description: "参会嘉宾抵达会议现场，需要完成注册手续并获取会议资料",
                chinese: "这是您的参会资料包，里面有会议材料和日程。",
                pinyin: "Zhè shì nín de cānhuì zīliào bāo, lǐmiàn yǒu huìyì cáiliào hé rìchéng.",
                english: "Here is your conference bag. It contains the meeting materials and schedule."
            },
            {
                scene: "报到注册",
                time: "6-7日全天",
                description: "参会嘉宾抵达会议现场，需要完成注册手续并获取会议资料",
                chinese: "休息区在左边，提供免费茶水。",
                pinyin: "Xiūxí qū zài zuǒbiān, tígōng miǎnfèi cháshuǐ.",
                english: "The rest area is on your left. Free tea is provided."
            },
            {
                scene: "引导带路",
                time: "全流程",
                description: "引导参会嘉宾前往不同会议地点",
                chinese: "请跟我来，会议室在前面。",
                pinyin: "Qǐng gēn wǒ lái, huìyì shì zài qiánmiàn.",
                english: "Please follow me. The meeting room is straight ahead."
            },
            {
                scene: "引导带路",
                time: "全流程",
                description: "引导参会嘉宾前往不同会议地点",
                chinese: "小心台阶！",
                pinyin: "Xiǎoxīn táijiē!",
                english: "Watch your step!"
            },
            {
                scene: "引导带路",
                time: "全流程",
                description: "引导参会嘉宾前往不同会议地点",
                chinese: "卫生间在走廊尽头右转。",
                pinyin: "Wèishēngjiān zài zǒuláng jìntóu yòu zhuǎn.",
                english: "The restroom is to the right, at the end of the hallway."
            },
            {
                scene: "开幕式",
                time: "8日上午",
                description: "会议开幕式，重要嘉宾发言",
                chinese: "请您稍等，仪式五分钟后开始。",
                pinyin: "Qǐng nín shāo děng, yíshì wǔ fēnzhōng hòu kāishǐ.",
                english: "The ceremony will begin in five minutes. Please wait a moment."
            },
            {
                scene: "开幕式",
                time: "9日上午",
                description: "会议开幕式，重要嘉宾发言",
                chinese: "请您站在签约台中间的位置。",
                pinyin: "Qǐng nín zhàn zài qiānyuē tái zhōngjiān de wèizhì.",
                english: "Please stand in the center of the signing table."
            },
            {
                scene: "开幕式",
                time: "9日上午",
                description: "会议开幕式，重要嘉宾发言",
                chinese: "这是待签署的文件，请您过目。",
                pinyin: "Zhè shì dài qiānshǔ de wénjiàn, qǐng nín guòmù.",
                english: "Here is the document for signing. Please review it."
            },
            {
                scene: "茶歇服务",
                time: "茶歇时间",
                description: "提供茶歇服务",
                chinese: "咖啡和茶在这里取用。",
                pinyin: "Kāfēi hé chá zài zhèlǐ qǔyòng.",
                english: "Coffee and tea are available here."
            },
            {
                scene: "茶歇服务",
                time: "茶歇时间",
                description: "提供茶歇服务",
                chinese: "需要加牛奶吗？(递上)",
                pinyin: "Xūyào jiā niúnǎi ma? (dì shàng)",
                english: "Would you like some milk? (while offering)"
            },
            {
                scene: "茶歇服务",
                time: "茶歇时间",
                description: "提供茶歇服务",
                chinese: "清真点心放在蓝色托盘里。",
                pinyin: "Qīngzhēn diǎnxīn fàng zài lán sè tuōpán lǐ.",
                english: "The halal snacks are on the blue tray."
            },
            {
                scene: "茶歇服务",
                time: "茶歇时间",
                description: "提供茶歇服务",
                chinese: "需要方糖吗？",
                pinyin: "Xūyào fāngtáng ma?",
                english: "Would you like some sugar?"
            },
            {
                scene: "茶歇服务",
                time: "茶歇时间",
                description: "提供茶歇服务",
                chinese: "点心请自取。",
                pinyin: "Diǎnxīn qǐng zìqǔ.",
                english: "Please help yourself to the snacks."
            },
            {
                scene: "茶歇服务",
                time: "茶歇时间",
                description: "提供茶歇服务",
                chinese: "垃圾请放入黑色的垃圾桶。",
                pinyin: "Lèsè qǐng fàng rù hēi sè de lèsè tǒng.",
                english: "Please put trash in the black bin."
            },
            {
                scene: "领导接待与会见",
                time: "会议期间",
                description: "接待领导及重要嘉宾",
                chinese: "晚宴在新加坡厅举行，请这边走。",
                pinyin: "Wǎnyàn zài Xīnjiāpō tīng jǔxíng, qǐng zhè biān zǒu.",
                english: "The dinner is in the Singapore Hall. This way, please."
            },
            {
                scene: "领导接待与会见",
                time: "会议期间",
                description: "接待领导及重要嘉宾",
                chinese: "您的座位在主桌一号位。",
                pinyin: "Nín de zuòwèi zài zhǔ zhuō yī hào wèi.",
                english: "Your seat is number one at the main table."
            },
            {
                scene: "领导接待与会见",
                time: "会议期间",
                description: "接待领导及重要嘉宾",
                chinese: "这是今晚的菜单，主菜可选牛肉或鱼。",
                pinyin: "Zhè shì jīn wǎn de càidān, zhǔ cài kě xuǎn niúròu huò yú.",
                english: "Here is the menu. The main course is beef or fish."
            },
            {
                scene: "领导接待与会见",
                time: "会议期间",
                description: "接待领导及重要嘉宾",
                chinese: "会见室在这里。",
                pinyin: "Huìjiàn shì zài zhèlǐ.",
                english: "The meeting room is right here."
            },
            {
                scene: "领导接待与会见",
                time: "会议期间",
                description: "接待领导及重要嘉宾",
                chinese: "请您先就座，领导马上就到。",
                pinyin: "Qǐng nín xiān jiùzuò, lǐngdǎo mǎshàng jiù dào.",
                english: "Please have a seat. The VIP will arrive shortly."
            },
            {
                scene: "领导接待与会见",
                time: "会议期间",
                description: "接待领导及重要嘉宾",
                chinese: "请问您喝茶还是咖啡？",
                pinyin: "Qǐngwèn nín hē chá háishì kāfēi?",
                english: "Would you prefer tea or coffee?"
            },
            {
                scene: "研讨会服务",
                time: "会议期间",
                description: "为研讨会提供支持服务",
                chinese: "这是麦克风，提问时请举手。",
                pinyin: "Zhè shì màikèfēng, tíwèn shí qǐng jǔshǒu.",
                english: "Here is the microphone. Please raise your hand if you have a question."
            },
            {
                scene: "研讨会服务",
                time: "会议期间",
                description: "为研讨会提供支持服务",
                chinese: "矿泉水在桌子下面。",
                pinyin: "Kuàngquán shuǐ zài zhuōzi xiàmiàn.",
                english: "Bottled water is under the table."
            },
            {
                scene: "调研考察",
                time: "10日下午",
                description: "组织参会嘉宾进行实地考察",
                chinese: "大巴车车牌是桂 A12345。",
                pinyin: "Dàbā chē chēpái shì Guì A12345.",
                english: "The bus license plate is Gui-A12345."
            },
            {
                scene: "调研考察",
                time: "10日下午",
                description: "组织参会嘉宾进行实地考察",
                chinese: "车程大约需要 1 小时。",
                pinyin: "Chēchéng dàyuē xūyào 1 xiǎoshí.",
                english: "The drive will take about one hour."
            },
            {
                scene: "调研考察",
                time: "10日下午",
                description: "组织参会嘉宾进行实地考察",
                chinese: "请准时集合，不要迟到。",
                pinyin: "Qǐng zhǔnshí jíhé, bùyào chídào.",
                english: "Please gather on time."
            },
            {
                scene: "突发问题处理",
                time: "全流程",
                description: "处理会议中的突发问题",
                chinese: "请不要担心，我来帮您解决。",
                pinyin: "Qǐng bùyào dānxīn, wǒ lái bāng nín jiějué.",
                english: "Please don't worry, I will help you."
            },
            {
                scene: "突发问题处理",
                time: "全流程",
                description: "处理会议中的突发问题",
                chinese: "名字牌错了？我立刻给您换一个新的！",
                pinyin: "Míngzì pái cuò le? Wǒ lìkè gěi nín huàn yīgè xīn de!",
                english: "Is the name card incorrect? I'll get a new one for you right away!"
            },
            {
                scene: "突发问题处理",
                time: "全流程",
                description: "处理会议中的突发问题",
                chinese: "需要祈祷室吗？我带您去二楼。",
                pinyin: "Xūyào qídǎo shì ma? Wǒ dài nín qù èr lóu.",
                english: "Do you need a prayer room? I can take you to the second floor."
            },
            {
                scene: "突发问题处理",
                time: "全流程",
                description: "处理会议中的突发问题",
                chinese: "无线网络密码是 888888。",
                pinyin: "Wúxiàn wǎngluò mìmǎ shì 888888.",
                english: "The WiFi password is 888888."
            },
            {
                scene: "突发问题处理",
                time: "全流程",
                description: "处理会议中的突发问题",
                chinese: "您丢东西了？我帮您广播寻找。",
                pinyin: "Nín diū dōngxī le? Wǒ bāng nín guǎngbō xúnzhǎo.",
                english: "Did you lose something? I can make an announcement for you."
            },
            {
                scene: "突发问题处理",
                time: "全流程",
                description: "处理会议中的突发问题",
                chinese: "医生马上就到！",
                pinyin: "Yīshēng mǎshàng jiù dào!",
                english: "A doctor is on the way!"
            },
            {
                scene: "送站与离会服务",
                time: "会议最后一天",
                description: "为嘉宾提供离会服务",
                chinese: "大巴在酒店门口等候。",
                pinyin: "Dàbā zài jiǔdiàn ménkǒu děnghòu.",
                english: "The bus is waiting at the hotel entrance."
            },
            {
                scene: "送站与离会服务",
                time: "会议最后一天",
                description: "为嘉宾提供离会服务",
                chinese: "去机场大约需要 40 分钟车程。",
                pinyin: "Qù jīchǎng dàyuē xūyào 40 fēnzhōng chēchéng.",
                english: "It takes about 40 minutes to get to the airport."
            },
            {
                scene: "送站与离会服务",
                time: "会议最后一天",
                description: "为嘉宾提供离会服务",
                chinese: "开发票请到前台。",
                pinyin: "Kāi fāpiào qǐng dào qiántái.",
                english: "Please go to the front desk for the invoice."
            },
            {
                scene: "送站与离会服务",
                time: "会议最后一天",
                description: "为嘉宾提供离会服务",
                chinese: "我帮您拿行李吧。",
                pinyin: "Wǒ bāng nín ná xínglǐ ba.",
                english: "Let me help you with your luggage."
            },
            {
                scene: "送站与离会服务",
                time: "会议最后一天",
                description: "为嘉宾提供离会服务",
                chinese: "下次再见！",
                pinyin: "Xià cì zàijiàn!",
                english: "Hope to see you again!"
            },
            {
                scene: "万能备用句",
                time: "全流程",
                description: "通用交流语句",
                chinese: "请稍等，我查一下。",
                pinyin: "Qǐng shāo děng, wǒ chá yīxià.",
                english: "Just a moment, please. Let me check."
            },
            {
                scene: "万能备用句",
                time: "全流程",
                description: "通用交流语句",
                chinese: "是的。/ 不是。",
                pinyin: "Shì de./ Bùshì.",
                english: "Yes. / No."
            },
            {
                scene: "万能备用句",
                time: "全流程",
                description: "通用交流语句",
                chinese: "很抱歉，我们马上处理。",
                pinyin: "Hěn bàoqiàn, wǒmen mǎshàng chǔlǐ.",
                english: "I'm sorry about that. We will fix it immediately."
            },
            {
                scene: "万能备用句",
                time: "全流程",
                description: "通用交流语句",
                chinese: "我听不懂，能请您写下来吗？",
                pinyin: "Wǒ tīng bù dǒng, néng qǐng nín xiě xiàlái ma?",
                english: "I don't understand. Could you please write it down?"
            },
            {
                scene: "万能备用句",
                time: "全流程",
                description: "通用交流语句",
                chinese: "我找一位同事来帮您。",
                pinyin: "Wǒ zhǎo yī wèi tóngshì lái bāng nín.",
                english: "I will find a colleague to help you."
            },
            {
                scene: "万能备用句",
                time: "全流程",
                description: "通用交流语句",
                chinese: "祝您一切顺利！",
                pinyin: "Zhù nín yīqiè shùnlì!",
                english: "All the best!"
            }
        ];

        // 游戏状态
        let currentPhraseIndex = 0;
        let completedPhrases = 0;
        const totalPhrases = phrases.length;
        let isRecording = false;
        let isPlayingAudio = false;
        let recordingTime = 0;
        let recordingTimer;
        
        // 音频录制相关变量
        let mediaRecorder;
        let audioChunks = [];
        let audioBlob;
        let audioUrl;
        let audioContext;
        let analyser;
        let canvasCtx;
        let animationId;
        
        // 语音合成对象
        const synth = window.speechSynthesis;
        let isPlayingSpeech = false;
        
        // DOM元素
        const phraseChinese = document.getElementById('phrase-chinese');
        const phrasePinyin = document.getElementById('phrase-pinyin');
        const phraseEnglish = document.getElementById('phrase-english');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const scoreDetail = document.getElementById('score-detail');
        const recordBtn = document.getElementById('record-btn');
        const playbackBtn = document.getElementById('playback-btn');
        const saveBtn = document.getElementById('save-btn');
        const playChineseBtn = document.getElementById('play-chinese-btn');
        const playEnglishBtn = document.getElementById('play-english-btn');
        const playSlowBtn = document.getElementById('play-slow-btn');
        const recordingIndicator = document.getElementById('recording-indicator');
        const statusIndicator = document.getElementById('status-indicator');
        const completionMessage = document.getElementById('completion-message');
        const restartBtn = document.getElementById('restart-btn');
        const currentScene = document.getElementById('current-scene');
        const currentTime = document.getElementById('current-time');
        const sceneDescription = document.getElementById('scene-description');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const retryBtn = document.getElementById('retry-btn');
        const voiceWave = document.getElementById('voice-wave');
        const audioPlayer = document.getElementById('audio-player');
        const audioPlayback = document.getElementById('audio-playback');
        const playAudioBtn = document.getElementById('play-audio-btn');
        const pauseAudioBtn = document.getElementById('pause-audio-btn');
        const visualizerCanvas = document.getElementById('visualizer-canvas');
        const recordingTimerEl = document.getElementById('recording-timer');
        
        // 初始化可视化画布
        function initVisualizer() {
            const canvas = document.getElementById('visualizer-canvas');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            canvasCtx = canvas.getContext('2d');
        }
        
        // 绘制音频波形
        function drawWaveform() {
            if (!analyser || !canvasCtx) return;
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteTimeDomainData(dataArray);
            
            canvasCtx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
            canvasCtx.lineWidth = 2;
            canvasCtx.strokeStyle = '#1a2980';
            canvasCtx.beginPath();
            
            const sliceWidth = visualizerCanvas.width * 1.0 / bufferLength;
            let x = 0;
            
            for(let i = 0; i < bufferLength; i++) {
                const v = dataArray[i] / 128.0;
                const y = v * visualizerCanvas.height / 2;
                
                if(i === 0) {
                    canvasCtx.moveTo(x, y);
                } else {
                    canvasCtx.lineTo(x, y);
                }
                
                x += sliceWidth;
            }
            
            canvasCtx.lineTo(visualizerCanvas.width, visualizerCanvas.height / 2);
            canvasCtx.stroke();
            
            animationId = requestAnimationFrame(drawWaveform);
        }
        
        // 初始化游戏
        function initGame() {
            currentPhraseIndex = 0;
            completedPhrases = 0;
            updatePhrase();
            updateProgress();
            completionMessage.style.display = 'none';
            document.querySelector('.dialogue-area').style.display = 'flex';
            document.querySelector('.tips').style.display = 'block';
            voiceWave.style.display = 'flex';
            audioPlayer.style.display = 'none';
            initVisualizer();
        }
        
        // 更新短语显示
        function updatePhrase() {
            const phrase = phrases[currentPhraseIndex];
            
            phraseChinese.textContent = phrase.chinese;
            phrasePinyin.textContent = phrase.pinyin;
            phraseEnglish.textContent = phrase.english;
            currentScene.textContent = phrase.scene;
            currentTime.textContent = phrase.time;
            sceneDescription.textContent = phrase.description;
            
            // 重置按钮状态
            recordBtn.innerHTML = '<i class="fas fa-microphone"></i> 开始跟读';
            recordBtn.disabled = false;
            playbackBtn.disabled = true;
            saveBtn.disabled = true;
            recordingIndicator.innerHTML = '<div class="record-dot"></div><div>准备跟读 - 点击下方按钮开始</div>';
            recordingIndicator.classList.remove('recording');
            isRecording = false;
            recordingTime = 0;
            recordingTimerEl.textContent = '00:00';
            
            // 更新状态指示器
            updateStatusIndicator('ready', '准备播放...');
            
            // 停止所有语音
            stopAllAudio();
            
            // 重置录音
            audioChunks = [];
            audioBlob = null;
            audioUrl = null;
            audioPlayer.style.display = 'none';
            
            // 停止可视化
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            // 清除画布
            if (canvasCtx) {
                canvasCtx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
            }
        }
        
        // 停止所有音频播放
        function stopAllAudio() {
            // 停止语音合成
            if (synth.speaking) {
                synth.cancel();
                isPlayingSpeech = false;
            }
            
            // 停止录音播放
            if (!audioPlayback.paused) {
                audioPlayback.pause();
                audioPlayback.currentTime = 0;
                isPlayingAudio = false;
                playAudioBtn.disabled = false;
                pauseAudioBtn.disabled = true;
            }
        }
        
        // 更新状态指示器
        function updateStatusIndicator(type, message) {
            const dot = statusIndicator.querySelector('.status-dot');
            statusIndicator.className = 'status-indicator';
            dot.className = 'status-dot';
            
            if (type === 'playing') {
                statusIndicator.classList.add('status-playing');
                dot.classList.add('playing-dot');
            } else if (type === 'recording') {
                statusIndicator.classList.add('status-recording');
                dot.classList.add('recording-dot');
            } else {
                statusIndicator.classList.remove('status-playing', 'status-recording');
            }
            
            statusIndicator.querySelector('span').textContent = message;
        }
        
        // 更新进度
        function updateProgress() {
            const progressPercent = Math.round((completedPhrases / totalPhrases) * 100);
            progressBar.style.width = `${progressPercent}%`;
            progressText.textContent = `学习进度: ${completedPhrases}/${totalPhrases} (${progressPercent}%)`;
            scoreDetail.textContent = `已完成: ${completedPhrases}/${totalPhrases}`;
        }
        
        // 播放文本 - 修复核心部分
        function playText(text, lang, rate = 1.0) {
            stopAllAudio();
            
            isPlayingSpeech = true;
            updateStatusIndicator('playing', '播放中...');
            
            // 创建语音实例
            const utterance = new SpeechSynthesisUtterance(text);
            
            // 尝试找到合适的语音
            let voices = speechSynthesis.getVoices();
            let voiceFound = false;
            
            // 对于中文，优先使用中文语音
            if (lang === 'zh-CN') {
                for (let voice of voices) {
                    if (voice.lang.includes('zh-CN') || voice.lang.includes('zh')) {
                        utterance.voice = voice;
                        voiceFound = true;
                        break;
                    }
                }
            } 
            // 对于英文，优先使用英文语音
            else if (lang === 'en-US') {
                for (let voice of voices) {
                    if (voice.lang.includes('en-US') || voice.lang.includes('en-GB') || voice.lang.includes('en')) {
                        utterance.voice = voice;
                        voiceFound = true;
                        break;
                    }
                }
            }
            
            // 如果没有找到特定语言的语音，使用默认设置
            if (!voiceFound) {
                utterance.lang = lang;
            }
            
            utterance.rate = rate;
            
            // 语音事件处理
            utterance.onstart = function() {
                isPlayingSpeech = true;
            };
            
            utterance.onend = function() {
                isPlayingSpeech = false;
                updateStatusIndicator('ready', '播放完成');
                setTimeout(() => {
                    updateStatusIndicator('ready', '准备播放...');
                }, 2000);
            };
            
            utterance.onerror = function(event) {
                isPlayingSpeech = false;
                console.error('语音播放错误:', event.error);
                
                // 根据错误类型显示不同的提示
                let errorMessage = '播放出错，请重试';
                if (event.error === 'not-allowed') {
                    errorMessage = '需要允许语音播放权限';
                } else if (event.error === 'no-speech') {
                    errorMessage = '未找到语音数据';
                } else if (event.error === 'audio-capture') {
                    errorMessage = '音频捕获失败';
                }
                
                updateStatusIndicator('ready', errorMessage);
            };
            
            // 确保语音合成已经加载完成
            if (voices.length === 0) {
                // 监听语音加载完成事件
                speechSynthesis.onvoiceschanged = function() {
                    voices = speechSynthesis.getVoices();
                    // 再次尝试设置语音
                    if (lang === 'zh-CN') {
                        for (let voice of voices) {
                            if (voice.lang.includes('zh-CN') || voice.lang.includes('zh')) {
                                utterance.voice = voice;
                                break;
                            }
                        }
                    } else if (lang === 'en-US') {
                        for (let voice of voices) {
                            if (voice.lang.includes('en-US') || voice.lang.includes('en-GB') || voice.lang.includes('en')) {
                                utterance.voice = voice;
                                break;
                            }
                        }
                    }
                    synth.speak(utterance);
                    // 清除事件监听
                    speechSynthesis.onvoiceschanged = null;
                };
            } else {
                synth.speak(utterance);
            }
        }
        
        // 开始跟读
        async function startRecording() {
            if (isRecording) return;
            
            try {
                stopAllAudio();
                
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                
                // 初始化音频上下文和分析器
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const source = audioContext.createMediaStreamSource(stream);
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 2048;
                source.connect(analyser);
                
                // 开始可视化
                drawWaveform();
                
                // 设置录音数据处理器
                audioChunks = [];
                mediaRecorder.ondataavailable = function(event) {
                    audioChunks.push(event.data);
                };
                
                mediaRecorder.onstop = function() {
                    audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    audioUrl = URL.createObjectURL(audioBlob);
                    audioPlayback.src = audioUrl;
                    
                    // 断开音频节点
                    stream.getTracks().forEach(track => track.stop());
                    
                    // 停止可视化
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                    }
                    
                    // 清除画布
                    if (canvasCtx) {
                        canvasCtx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);
                    }
                };
                
                // 开始录音
                mediaRecorder.start();
                isRecording = true;
                recordBtn.innerHTML = '<i class="fas fa-stop"></i> 停止录音';
                recordingIndicator.innerHTML = '<div class="record-dot"></div><div>录音中...请跟读</div>';
                recordingIndicator.classList.add('recording');
                updateStatusIndicator('recording', '录音中...请跟读');
                playbackBtn.disabled = true;
                saveBtn.disabled = true;
                audioPlayer.style.display = 'none';
                
                // 开始计时
                recordingTime = 0;
                clearInterval(recordingTimer);
                recordingTimer = setInterval(() => {
                    recordingTime++;
                    const minutes = Math.floor(recordingTime / 60).toString().padStart(2, '0');
                    const seconds = (recordingTime % 60).toString().padStart(2, '0');
                    recordingTimerEl.textContent = `${minutes}:${seconds}`;
                }, 1000);
            } catch (error) {
                console.error('录音权限被拒绝或出现错误:', error);
                alert('无法访问麦克风，请确保已授予录音权限');
                isRecording = false;
                updateStatusIndicator('ready', '录音权限被拒绝');
            }
        }
        
        // 停止跟读
        function stopRecording() {
            if (!isRecording || !mediaRecorder) return;
            
            mediaRecorder.stop();
            isRecording = false;
            recordBtn.innerHTML = '<i class="fas fa-microphone"></i> 重新录制';
            recordingIndicator.innerHTML = '<div class="record-dot"></div><div>录音完成！</div>';
            recordingIndicator.classList.remove('recording');
            playbackBtn.disabled = false;
            saveBtn.disabled = false;
            updateStatusIndicator('ready', '录音完成，可以播放');
            
            // 停止计时
            clearInterval(recordingTimer);
            
            // 显示音频播放器
            audioPlayer.style.display = 'flex';
            
            // 标记为已完成
            if (completedPhrases <= currentPhraseIndex) {
                completedPhrases++;
                updateProgress();
            }
        }
        
        // 播放录音
        function playRecording() {
            if (!audioUrl) return;
            
            stopAllAudio();
            
            audioPlayback.play();
            playAudioBtn.disabled = true;
            pauseAudioBtn.disabled = false;
            updateStatusIndicator('playing', '正在播放您的录音...');
        }
        
        // 播放中文
        function playChinese() {
            playText(phrases[currentPhraseIndex].chinese, 'zh-CN');
        }
        
        // 播放英文
        function playEnglish() {
            playText(phrases[currentPhraseIndex].english, 'en-US');
        }
        
        // 慢速播放
        function playSlow() {
            playText(phrases[currentPhraseIndex].english, 'en-US', 0.7);
        }
        
        // 保存录音
        function saveRecording() {
            if (!audioBlob) return;
            
            const a = document.createElement('a');
            a.href = audioUrl;
            a.download = `跟读录音_第${currentPhraseIndex + 1}句.wav`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            alert('录音已保存！');
        }
        
        // 下一句
        function nextPhrase() {
            if (currentPhraseIndex < totalPhrases - 1) {
                currentPhraseIndex++;
                updatePhrase();
            } else {
                // 完成所有短语
                document.querySelector('.dialogue-area').style.display = 'none';
                document.querySelector('.tips').style.display = 'none';
                voiceWave.style.display = 'none';
                completionMessage.style.display = 'block';
            }
        }
        
        // 上一句
        function prevPhrase() {
            if (currentPhraseIndex > 0) {
                currentPhraseIndex--;
                updatePhrase();
            }
        }
        
        // 事件监听
        recordBtn.addEventListener('click', function() {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        });
        
        playbackBtn.addEventListener('click', playRecording);
        saveBtn.addEventListener('click', saveRecording);
        playChineseBtn.addEventListener('click', playChinese);
        playEnglishBtn.addEventListener('click', playEnglish);
        playSlowBtn.addEventListener('click', playSlow);
        nextBtn.addEventListener('click', nextPhrase);
        prevBtn.addEventListener('click', prevPhrase);
        retryBtn.addEventListener('click', updatePhrase);
        restartBtn.addEventListener('click', initGame);
        
        // 音频播放器控制
        playAudioBtn.addEventListener('click', function() {
            audioPlayback.play();
            playAudioBtn.disabled = true;
            pauseAudioBtn.disabled = false;
            updateStatusIndicator('playing', '正在播放您的录音...');
        });
        
        pauseAudioBtn.addEventListener('click', function() {
            audioPlayback.pause();
            playAudioBtn.disabled = false;
            pauseAudioBtn.disabled = true;
            updateStatusIndicator('ready', '播放已暂停');
        });
        
        audioPlayback.addEventListener('ended', function() {
            playAudioBtn.disabled = false;
            pauseAudioBtn.disabled = true;
            updateStatusIndicator('ready', '播放完成');
        });
        
        // 确保语音列表已加载
        window.speechSynthesis.onvoiceschanged = function() {
            console.log('语音列表已加载');
        };
        
        // 初始化游戏
        initGame();
        
        // 确保在页面关闭前停止所有音频
        window.addEventListener('beforeunload', function() {
            stopAllAudio();
        });
    </script>
</body>
</html>